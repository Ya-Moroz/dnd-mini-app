<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Critical Roll — Master App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* D&D Aesthetics */
        body {
            background: #1a1a1a; /* Темный фон подземелья */
            color: #e0d1b0; /* Цвет старого пергамента */
            font-family: 'Georgia', serif;
            margin: 0;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            border-bottom: 2px solid #8b0000;
            margin-bottom: 20px;
            width: 100%;
        }

        .header h1 {
            color: #d4af37; /* Золотой */
            text-transform: uppercase;
            letter-spacing: 2px;
            margin: 10px 0;
            font-size: 1.5rem;
        }

        /* Экран результата броска */
        .dice-display {
            background: radial-gradient(circle, #2c2c2c 0%, #1a1a1a 100%);
            width: 120px;
            height: 120px;
            border: 4px solid #d4af37;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 10px #ff0000;
            margin-bottom: 30px;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }

        /* Сетка кнопок кубиков */
        .dice-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            width: 100%;
            max-width: 300px;
        }

        .dice-btn {
            background: #4a0404; /* Темно-красный */
            color: #e0d1b0;
            border: 2px solid #d4af37;
            border-radius: 8px;
            padding: 15px 5px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 4px 0 #2a0202;
        }

        .dice-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #2a0202;
            background: #8b0000;
        }

        .log {
            margin-top: 20px;
            font-size: 0.9rem;
            color: #888;
            font-style: italic;
        }

        /* Анимация броска */
        .shake {
            animation: shake 0.2s ease-in-out;
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            20% { transform: translate(-3px, 0px) rotate(-5deg); }
            40% { transform: translate(3px, 2px) rotate(5deg); }
            60% { transform: translate(-1px, -1px) rotate(-1deg); }
            80% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(0px, 0px) rotate(0deg); }
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>Критический бросок</h1>
    </div>

    <div id="result-box" class="dice-display">?</div>

    <div class="dice-grid">
        <button class="dice-btn" onclick="rollDice(4)">d4</button>
        <button class="dice-btn" onclick="rollDice(6)">d6</button>
        <button class="dice-btn" onclick="rollDice(8)">d8</button>
        <button class="dice-btn" onclick="rollDice(10)">d10</button>
        <button class="dice-btn" onclick="rollDice(12)">d12</button>
        <button class="dice-btn" onclick="rollDice(20)">d20</button>
    </div>

    <div class="log" id="dice-log">Нажми на кубик, чтобы бросить...</div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // Скрываем стандартную кнопку TG, так как у нас свой интерфейс
        tg.MainButton.hide();

        function rollDice(sides) {
            const resultBox = document.getElementById('result-box');
            const log = document.getElementById('dice-log');
            
            // Добавляем эффект тряски
            resultBox.classList.remove('shake');
            void resultBox.offsetWidth; // Магия для перезапуска анимации
            resultBox.classList.add('shake');

            // Вибрация (для d20 посильнее)
            if (sides === 20) {
                tg.HapticFeedback.notificationOccurred('warning');
            } else {
                tg.HapticFeedback.impactOccurred('medium');
            }

            // Сам бросок
            const result = Math.floor(Math.random() * sides) + 1;
            
            // Вывод результата
            resultBox.innerText = result;
            log.innerText = `Выпало ${result} на d${sides}`;

            // Подсветка крита на d20
            if (sides === 20 && result === 20) {
                resultBox.style.color = "#ffd700";
                resultBox.style.textShadow = "0 0 20px #fff";
            } else if (sides === 20 && result === 1) {
                resultBox.style.color = "#ff4d4d";
                resultBox.style.textShadow = "none";
            } else {
                resultBox.style.color = "#fff";
                resultBox.style.textShadow = "0 0 10px #ff0000";
            }
        }
    </script>
</body>
</html>
